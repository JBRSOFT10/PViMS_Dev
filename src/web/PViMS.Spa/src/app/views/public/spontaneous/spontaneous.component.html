<div style="height: 5px">
  <mat-progress-bar
    mode="indeterminate"
    color="primary"
    *ngIf="isBusy()"></mat-progress-bar>
</div>

<div class="form-wrap">
  <div
    fxLayout="row"
    fxLayout.sm="column"
    fxLayoutWrap
    fxLayoutGap="0.1%"
    fxLayoutAlign="center center">
    <div fxFlex.gt-sm="75" fxFlex.lt-md="100" class="mat-elevation-z2 p-24">
      <div class="text-center">
        <h1 class="title center font-weight-bold">
          {{ 'Yellow Card' | translate }}
        </h1>
      </div>

      <div class="card-title-text light-gray p-24">
        {{ 'Please enter details of the reaction below' | translate }}
      </div>

      <form [formGroup]="viewModelForm" (keydown.enter)="prevent($event)">
        <mat-horizontal-stepper formArrayName="formArray" linear>
          <mat-step
            *ngFor="
              let form of viewModelForm.get('formArray')['controls'];
              let i = index
            "
            [formGroupName]="i"
            [stepControl]="form">
            <ng-template matStepLabel>
              {{ datasetCategories[i]?.datasetCategoryDisplayName }}
            </ng-template>

            <div
              class="card-title-text light-gray p-24"
              *ngIf="datasetCategories[i]?.datasetCategoryHelp != ''">
              {{ datasetCategories[i]?.datasetCategoryHelp }}
            </div>

            <div
              class="yellow-form"
              fxLayout="row wrap"
              fxLayout.lt-sm="column"
              fxLayoutAlign="start start"
              formGroupName="elements">
              <div
                fxFlex="100"
                class="pr-1 form-field"
                *ngFor="let element of datasetCategories[i]?.datasetElements">
                <mat-form-field
                  class="p-8 full-width"
                  appearance="fill"
                  *ngIf="element.datasetElementSystem">
                  <mat-label>{{
                    element.datasetElementDisplayName | translate
                  }}</mat-label>
                  <input
                    matInput
                    formControlName="{{ element.datasetElementId }}"
                    placeholder="{{
                      element.datasetElementDisplayName | translate
                    }}"
                    readonly />
                  <mat-hint *ngIf="element.datasetElementHelp != ''">
                    {{ element.datasetElementHelp }}
                  </mat-hint>
                </mat-form-field>

                <mat-form-field
                  class="p-8 full-width"
                  *ngIf="
                    element.datasetElementType == 'AlphaNumericTextbox' &&
                    !element.datasetElementSystem &&
                    element.stringMaxLength <= 100 &&
                    element.datasetElementId !== 126 &&
                    element.datasetElementId !== 153 &&
                    element.datasetElementId !== 298 &&
                    element.datasetElementId !== 302 &&
                    element.datasetElementId !== 304
                  ">
                  <input
                    matInput
                    formControlName="{{ element.datasetElementId }}"
                    placeholder="{{
                      element.datasetElementDisplayName | translate
                    }}"
                    [required]="element.required"
                    label />
                  <mat-hint *ngIf="element.datasetElementHelp != ''">
                    {{ element.datasetElementHelp }}
                  </mat-hint>
                  <mat-hint
                    *ngIf="
                      element.datasetElementHelp == '' &&
                      element.stringMaxLength != null
                    ">
                    {{ 'Maximum length' | translate }}
                    {{ element.stringMaxLength }}
                  </mat-hint>
                </mat-form-field>

                <!-- If yes, please specify -->
                <mat-form-field
                  class="p-8 full-width"
                  *ngIf="
                    element.datasetElementType == 'AlphaNumericTextbox' &&
                    !element.datasetElementSystem &&
                    element.stringMaxLength <= 100 &&
                    element.datasetElementId === 126 &&
                    adverseEventTreatment === 'Yes'
                  ">
                  <input
                    matInput
                    formControlName="{{ element.datasetElementId }}"
                    placeholder="{{
                      element.datasetElementDisplayName | translate
                    }}"
                    [required]="adverseEventTreatment === 'Yes'" />
                  <mat-hint *ngIf="element.datasetElementHelp != ''">
                    {{ element.datasetElementHelp }}
                  </mat-hint>
                  <mat-hint
                    *ngIf="
                      element.datasetElementHelp == '' &&
                      element.stringMaxLength != null
                    ">
                    {{ 'Maximum length' | translate }}
                    {{ element.stringMaxLength }}
                  </mat-hint>
                </mat-form-field>

                <!-- If Others, please specify -->
                <mat-form-field
                  class="p-8 full-width"
                  *ngIf="
                    element.datasetElementType == 'AlphaNumericTextbox' &&
                    !element.datasetElementSystem &&
                    element.stringMaxLength <= 100 &&
                    element.datasetElementId === 153 &&
                    relevantHistory.includes('Others (Please specify)')
                  ">
                  <input
                    matInput
                    formControlName="{{ element.datasetElementId }}"
                    placeholder="{{
                      element.datasetElementDisplayName | translate
                    }}"
                    [required]="
                      relevantHistory.includes('Others (Please specify)')
                    " />
                  <mat-hint *ngIf="element.datasetElementHelp != ''">
                    {{ element.datasetElementHelp }}
                  </mat-hint>
                  <mat-hint
                    *ngIf="
                      element.datasetElementHelp == '' &&
                      element.stringMaxLength != null
                    ">
                    {{ 'Maximum length' | translate }}
                    {{ element.stringMaxLength }}
                  </mat-hint>
                </mat-form-field>

                <!-- If others, please specify (if select type of event to others) -->
                <mat-form-field
                  class="p-8 full-width"
                  *ngIf="
                    element.datasetElementType == 'AlphaNumericTextbox' &&
                    !element.datasetElementSystem &&
                    element.stringMaxLength <= 100 &&
                    element.datasetElementId === 298 &&
                    typeOfEvents.includes('Others')
                  ">
                  <input
                    matInput
                    formControlName="{{ element.datasetElementId }}"
                    placeholder="{{
                      element.datasetElementDisplayName | translate
                    }}"
                    [required]="typeOfEvents.includes('Others')" />
                  <mat-hint *ngIf="element.datasetElementHelp != ''">
                    {{ element.datasetElementHelp }}
                  </mat-hint>
                  <mat-hint
                    *ngIf="
                      element.datasetElementHelp == '' &&
                      element.stringMaxLength != null
                    ">
                    {{ 'Maximum length' | translate }}
                    {{ element.stringMaxLength }}
                  </mat-hint>
                </mat-form-field>

                <!-- Event information (If others, please specify) -->
                <mat-form-field
                  class="p-8 full-width"
                  *ngIf="
                    element.datasetElementType == 'AlphaNumericTextbox' &&
                    !element.datasetElementSystem &&
                    element.stringMaxLength <= 100 &&
                    element.datasetElementId === 302 &&
                    eventInformation.includes('Others')
                  ">
                  <input
                    matInput
                    formControlName="{{ element.datasetElementId }}"
                    placeholder="{{
                      element.datasetElementDisplayName | translate
                    }}"
                    [required]="eventInformation.includes('Others')" />
                  <mat-hint *ngIf="element.datasetElementHelp != ''">
                    {{ element.datasetElementHelp }}
                  </mat-hint>
                  <mat-hint
                    *ngIf="
                      element.datasetElementHelp == '' &&
                      element.stringMaxLength != null
                    ">
                    {{ 'Maximum length' | translate }}
                    {{ element.stringMaxLength }}
                  </mat-hint>
                </mat-form-field>

                <!-- Initial report -->
                <mat-form-field
                  class="p-8 full-width"
                  *ngIf="
                    element.datasetElementType == 'AlphaNumericTextbox' &&
                    !element.datasetElementSystem &&
                    element.stringMaxLength <= 100 &&
                    element.datasetElementId === 304 &&
                    sourceOfReport === 'Marketing authorization holder' &&
                    reportType === 'Follow-up report'
                  ">
                  <input
                    matInput
                    formControlName="{{ element.datasetElementId }}"
                    placeholder="{{
                      element.datasetElementDisplayName | translate
                    }}"
                    [required]="element.required" />
                  <mat-hint *ngIf="element.datasetElementHelp != ''">
                    {{ element.datasetElementHelp }}
                  </mat-hint>
                  <mat-hint
                    *ngIf="
                      element.datasetElementHelp == '' &&
                      element.stringMaxLength != null
                    ">
                    {{ 'Maximum length' | translate }}
                    {{ element.stringMaxLength }}
                  </mat-hint>
                </mat-form-field>

                <mat-form-field
                  class="p-8 full-width"
                  *ngIf="
                    element.datasetElementType == 'AlphaNumericTextbox' &&
                    !element.datasetElementSystem &&
                    element.stringMaxLength > 100
                  "
                  appearance="outline">
                  <mat-label>{{
                    element.datasetElementDisplayName | translate
                  }}</mat-label>
                  <textarea
                    matInput
                    formControlName="{{ element.datasetElementId }}"
                    placeholder="{{
                      element.datasetElementDisplayName | translate
                    }}"
                    [required]="element.required"
                    rows="8"></textarea>
                  <mat-hint *ngIf="element.datasetElementHelp != ''">
                    {{ element.datasetElementHelp }}
                  </mat-hint>
                  <mat-hint
                    *ngIf="
                      element.datasetElementHelp == '' &&
                      element.stringMaxLength != null
                    ">
                    {{ 'Maximum length' | translate }}
                    {{ element.stringMaxLength }}
                  </mat-hint>
                </mat-form-field>

                <mat-form-field
                  class="p-8 full-width"
                  *ngIf="
                    element.datasetElementType == 'NumericTextbox' &&
                    !element.datasetElementSystem &&
                    element.datasetElementId !== 107 &&
                    element.datasetElementId !== 295 &&
                    element.datasetElementId !== 296
                  ">
                  <input
                    matInput
                    formControlName="{{ element.datasetElementId }}"
                    placeholder="{{
                      element.datasetElementDisplayName | translate
                    }}"
                    type="number"
                    [required]="element.required" />
                  <mat-hint *ngIf="element.datasetElementHelp != ''">
                    {{ element.datasetElementHelp }}
                  </mat-hint>
                  <mat-hint
                    *ngIf="
                      element.datasetElementHelp == '' &&
                      element.numericMinValue != null &&
                      element.numericMaxValue != null
                    ">
                    {{ 'Valid between ' | translate }}
                    {{ element.numericMinValue }} {{ 'and ' | translate }}
                    {{ element.numericMaxValue }}
                  </mat-hint>
                </mat-form-field>

                <mat-form-field
                  class="p-8 full-width"
                  *ngIf="
                    element.datasetElementType == 'NumericTextbox' &&
                    !element.datasetElementSystem &&
                    (element.datasetElementId === 107 ||
                      element.datasetElementId === 295 ||
                      element.datasetElementId === 296)
                  ">
                  <input
                    matInput
                    formControlName="{{ element.datasetElementId }}"
                    placeholder="{{
                      element.datasetElementDisplayName | translate
                    }}"
                    type="number"
                    [readonly]="isAgeNotAvailable"
                    [required]="!isAgeNotAvailable" />
                  <mat-hint *ngIf="element.datasetElementHelp != ''">
                    {{ element.datasetElementHelp }}
                  </mat-hint>
                  <mat-hint
                    *ngIf="
                      element.datasetElementHelp == '' &&
                      element.numericMinValue != null &&
                      element.numericMaxValue != null
                    ">
                    {{ 'Valid between ' | translate }}
                    {{ element.numericMinValue }} {{ 'and ' | translate }}
                    {{ element.numericMaxValue }}
                  </mat-hint>
                </mat-form-field>

                <mat-form-field
                  class="p-8 full-width"
                  *ngIf="
                    element.datasetElementType == 'Date' &&
                    element.datasetElementId !== 156 &&
                    element.datasetElementId !== 116 &&
                    element.datasetElementId !== 117 &&
                    element.datasetElementId !== 123 &&
                    element.datasetElementId !== 124 &&
                    element.datasetElementId !== 140 &&
                    !element.datasetElementSystem
                  ">
                  <mat-datepicker-toggle
                    matPrefix
                    [for]="datepicker"></mat-datepicker-toggle>
                  <input
                    matInput
                    formControlName="{{ element.datasetElementId }}"
                    placeholder="{{
                      element.datasetElementDisplayName | translate
                    }}"
                    [matDatepicker]="datepicker"
                    [required]="element.required" />
                  <mat-hint *ngIf="element.datasetElementHelp != ''">
                    {{ element.datasetElementHelp }}
                  </mat-hint>
                  <mat-datepicker
                    startView="multi-year"
                    #datepicker></mat-datepicker>
                </mat-form-field>

                <!-- Medication start date -->
                <mat-form-field
                  class="p-8 full-width"
                  *ngIf="
                    element.datasetElementType == 'Date' &&
                    element.datasetElementId === 116 &&
                    !element.datasetElementSystem
                  ">
                  <mat-datepicker-toggle
                    matPrefix
                    [for]="medStartDatePicker"></mat-datepicker-toggle>
                  <input
                    matInput
                    formControlName="{{ element.datasetElementId }}"
                    placeholder="{{
                      element.datasetElementDisplayName | translate
                    }}"
                    [matDatepicker]="medStartDatePicker"
                    (dateChange)="medStartDateChange($event)"
                    [required]="isMedDateNotAvailable === 'No'"
                    readonly />
                  <mat-hint *ngIf="element.datasetElementHelp != ''">
                    {{ element.datasetElementHelp }}
                  </mat-hint>
                  <mat-datepicker
                    #medStartDatePicker
                    [disabled]="
                      isMedDateNotAvailable === 'Yes' ? true : false
                    "></mat-datepicker>
                </mat-form-field>

                <!-- Medication end date -->
                <mat-form-field
                  class="p-8 full-width"
                  *ngIf="
                    element.datasetElementType == 'Date' &&
                    element.datasetElementId === 117 &&
                    !element.datasetElementSystem
                  ">
                  <mat-datepicker-toggle
                    matPrefix
                    [for]="medEndDatePicker"
                    [disabled]="!medEndDateMin"></mat-datepicker-toggle>
                  <input
                    matInput
                    formControlName="{{ element.datasetElementId }}"
                    placeholder="{{
                      element.datasetElementDisplayName | translate
                    }}"
                    [matDatepicker]="medEndDatePicker"
                    [min]="medEndDateMin"
                    [required]="isMedDateNotAvailable === 'No'"
                    readonly />
                  <mat-hint *ngIf="element.datasetElementHelp != ''">
                    {{ element.datasetElementHelp }}
                  </mat-hint>
                  <mat-datepicker
                    #medEndDatePicker
                    [disabled]="
                      isMedDateNotAvailable === 'Yes' ? true : false
                    "></mat-datepicker>
                </mat-form-field>

                <!-- Event start date -->
                <mat-form-field
                  class="p-8 full-width"
                  *ngIf="
                    element.datasetElementType == 'Date' &&
                    element.datasetElementId === 123 &&
                    !element.datasetElementSystem
                  ">
                  <mat-datepicker-toggle
                    matPrefix
                    [for]="eventStartDatePicker"></mat-datepicker-toggle>
                  <input
                    matInput
                    formControlName="{{ element.datasetElementId }}"
                    placeholder="{{
                      element.datasetElementDisplayName | translate
                    }}"
                    [matDatepicker]="eventStartDatePicker"
                    (dateChange)="eventStartDateChange($event)"
                    [required]="isEventDateNotAvailable === 'No'"
                    readonly />
                  <mat-hint *ngIf="element.datasetElementHelp != ''">
                    {{ element.datasetElementHelp }}
                  </mat-hint>
                  <mat-datepicker
                    #eventStartDatePicker
                    [disabled]="
                      isEventDateNotAvailable === 'Yes' ? true : false
                    "></mat-datepicker>
                </mat-form-field>

                <!-- Event end date -->
                <mat-form-field
                  class="p-8 full-width"
                  *ngIf="
                    element.datasetElementType == 'Date' &&
                    element.datasetElementId === 124 &&
                    !element.datasetElementSystem
                  ">
                  <mat-datepicker-toggle
                    matPrefix
                    [for]="eventEndDatePicker"
                    [disabled]="!eventEndDateMin"></mat-datepicker-toggle>
                  <input
                    matInput
                    formControlName="{{ element.datasetElementId }}"
                    placeholder="{{
                      element.datasetElementDisplayName | translate
                    }}"
                    [matDatepicker]="eventEndDatePicker"
                    [min]="eventEndDateMin"
                    [required]="isEventDateNotAvailable === 'No'"
                    readonly />
                  <mat-hint *ngIf="element.datasetElementHelp != ''">
                    {{ element.datasetElementHelp }}
                  </mat-hint>
                  <mat-datepicker
                    #eventEndDatePicker
                    [disabled]="
                      isEventDateNotAvailable === 'Yes' ? true : false
                    "></mat-datepicker>
                </mat-form-field>

                <!-- Date of death -->
                <mat-form-field
                  class="p-8 full-width"
                  *ngIf="
                    element.datasetElementType == 'Date' &&
                    element.datasetElementId === 156 &&
                    outcomeOfAdverseEvent === 'Fatal' &&
                    !element.datasetElementSystem
                  ">
                  <mat-datepicker-toggle
                    matPrefix
                    [for]="fataldatepicker"></mat-datepicker-toggle>
                  <input
                    matInput
                    formControlName="{{ element.datasetElementId }}"
                    placeholder="{{
                      element.datasetElementDisplayName | translate
                    }}"
                    [matDatepicker]="fataldatepicker"
                    [required]="outcomeOfAdverseEvent === 'Fatal'" />
                  <mat-hint *ngIf="element.datasetElementHelp != ''">
                    {{ element.datasetElementHelp }}
                  </mat-hint>
                  <mat-datepicker #fataldatepicker></mat-datepicker>
                </mat-form-field>

                <!-- Date of report submission -->
                <mat-form-field
                  class="p-8 full-width"
                  *ngIf="
                    element.datasetElementType == 'Date' &&
                    element.datasetElementId === 140 &&
                    !element.datasetElementSystem
                  ">
                  <mat-datepicker-toggle
                    matPrefix
                    [for]="resportSubmitdatepicker"></mat-datepicker-toggle>
                  <input
                    matInput
                    formControlName="{{ element.datasetElementId }}"
                    placeholder="{{
                      element.datasetElementDisplayName | translate
                    }}"
                    [matDatepicker]="resportSubmitdatepicker"
                    [required]="element.required"
                    readonly />
                  <mat-hint *ngIf="element.datasetElementHelp != ''">
                    {{ element.datasetElementHelp }}
                  </mat-hint>
                  <mat-datepicker
                    #resportSubmitdatepicker
                    disabled></mat-datepicker>
                </mat-form-field>

                <mat-form-field
                  class="p-8 full-width"
                  *ngIf="
                    element.datasetElementType == 'DropDownList' &&
                    element.datasetElementId !== 110 &&
                    element.datasetElementId !== 111 &&
                    element.datasetElementId !== 148 &&
                    element.datasetElementId !== 149 &&
                    element.datasetElementId !== 150 &&
                    element.datasetElementId !== 152 &&
                    element.datasetElementId !== 305 &&
                    !element.datasetElementSystem
                  ">
                  <mat-select
                    formControlName="{{ element.datasetElementId }}"
                    placeholder="{{
                      element.datasetElementDisplayName | translate
                    }}"
                    [required]="element.required">
                    <mat-option value=""></mat-option>
                    <mat-option
                      *ngFor="let item of element.selectionDataItems"
                      value="{{ item.selectionKey }}">
                      {{ item.value | translate }}
                    </mat-option>
                  </mat-select>
                  <mat-hint *ngIf="element.datasetElementHelp != ''">
                    {{ element.datasetElementHelp }}
                  </mat-hint>
                </mat-form-field>

                <!-- Gender field -->
                <mat-form-field
                  class="p-8 full-width"
                  *ngIf="
                    element.datasetElementType == 'DropDownList' &&
                    !element.datasetElementSystem &&
                    element.datasetElementId === 110
                  ">
                  <mat-select
                    formControlName="{{ element.datasetElementId }}"
                    placeholder="{{
                      element.datasetElementDisplayName | translate
                    }}"
                    [required]="element.required"
                    (selectionChange)="onChangeGender($event)">
                    <mat-option value=""></mat-option>
                    <mat-option
                      *ngFor="let item of element.selectionDataItems"
                      value="{{ item.selectionKey }}">
                      {{ item.value | translate }}
                    </mat-option>
                  </mat-select>
                  <mat-hint *ngIf="element.datasetElementHelp != ''">
                    {{ element.datasetElementHelp }}
                  </mat-hint>
                </mat-form-field>

                <!-- Pregnant field -->
                <mat-form-field
                  class="p-8 full-width"
                  *ngIf="
                    element.datasetElementType == 'DropDownList' &&
                    !element.datasetElementSystem &&
                    element.datasetElementId === 111 &&
                    genderValue === 'Female'
                  ">
                  <mat-select
                    formControlName="{{ element.datasetElementId }}"
                    placeholder="{{
                      element.datasetElementDisplayName | translate
                    }}"
                    required="genderValue === 'Female'">
                    <mat-option value=""></mat-option>
                    <mat-option
                      *ngFor="let item of element.selectionDataItems"
                      value="{{ item.selectionKey }}">
                      {{ item.value | translate }}
                    </mat-option>
                  </mat-select>
                  <mat-hint *ngIf="element.datasetElementHelp != ''">
                    {{ element.datasetElementHelp }}
                  </mat-hint>
                </mat-form-field>

                <!-- Division field -->
                <mat-form-field
                  class="p-8 full-width"
                  *ngIf="
                    element.datasetElementType == 'DropDownList' &&
                    element.datasetElementId === 148 &&
                    !element.datasetElementSystem
                  ">
                  <mat-select
                    formControlName="{{ element.datasetElementId }}"
                    placeholder="{{
                      element.datasetElementDisplayName | translate
                    }}"
                    [required]="element.required"
                    [disabled]="divisionList.length === 0"
                    (selectionChange)="onChangeDivision($event)">
                    <mat-option value=""></mat-option>
                    <mat-option
                      *ngFor="let item of divisionList"
                      value="{{ item.selectedkey }}">
                      {{ item.selectedValue | translate }}
                    </mat-option>
                  </mat-select>
                  <mat-hint *ngIf="element.datasetElementHelp != ''">
                    {{ element.datasetElementHelp }}
                  </mat-hint>
                </mat-form-field>

                <!-- District field -->
                <mat-form-field
                  class="p-8 full-width"
                  *ngIf="
                    element.datasetElementType == 'DropDownList' &&
                    element.datasetElementId === 149 &&
                    !element.datasetElementSystem
                  ">
                  <mat-select
                    formControlName="{{ element.datasetElementId }}"
                    placeholder="{{
                      element.datasetElementDisplayName | translate
                    }}"
                    [required]="element.required"
                    [disabled]="districtList.length === 0"
                    (selectionChange)="onChangeDistrict($event)">
                    <mat-option value=""></mat-option>
                    <mat-option
                      *ngFor="let item of districtList"
                      value="{{ item.selectedkey }}">
                      {{ item.selectedValue | translate }}
                    </mat-option>
                  </mat-select>
                  <mat-hint *ngIf="element.datasetElementHelp != ''">
                    {{ element.datasetElementHelp }}
                  </mat-hint>
                </mat-form-field>

                <!-- Thana field -->
                <mat-form-field
                  class="p-8 full-width"
                  *ngIf="
                    element.datasetElementType == 'DropDownList' &&
                    element.datasetElementId === 150 &&
                    !element.datasetElementSystem
                  ">
                  <mat-select
                    formControlName="{{ element.datasetElementId }}"
                    placeholder="{{
                      element.datasetElementDisplayName | translate
                    }}"
                    [required]="element.required"
                    [disabled]="thanaList.length === 0">
                    <mat-option value=""></mat-option>
                    <mat-option
                      *ngFor="let item of thanaList"
                      value="{{ item.selectedkey }}">
                      {{ item.selectedValue | translate }}
                    </mat-option>
                  </mat-select>
                  <mat-hint *ngIf="element.datasetElementHelp != ''">
                    {{ element.datasetElementHelp }}
                  </mat-hint>
                </mat-form-field>

                <!-- Organization field -->
                <mat-form-field
                  class="p-8 full-width"
                  *ngIf="
                    element.datasetElementType == 'DropDownList' &&
                    element.datasetElementId === 152 &&
                    sourceOfReport !== 'Marketing authorization holder' &&
                    !element.datasetElementSystem
                  ">
                  <mat-select
                    formControlName="{{ element.datasetElementId }}"
                    placeholder="{{
                      element.datasetElementDisplayName | translate
                    }}"
                    [required]="
                      sourceOfReport !== 'Marketing authorization holder'
                    ">
                    <mat-option value=""></mat-option>
                    <mat-option
                      *ngFor="let item of element.selectionDataItems"
                      value="{{ item.selectionKey }}">
                      {{ item.value | translate }}
                    </mat-option>
                  </mat-select>
                  <mat-hint *ngIf="element.datasetElementHelp != ''">
                    {{ element.datasetElementHelp }}
                  </mat-hint>
                </mat-form-field>

                <!-- Company field -->
                <mat-form-field
                  class="p-8 full-width"
                  *ngIf="
                    element.datasetElementType == 'DropDownList' &&
                    element.datasetElementId === 305 &&
                    sourceOfReport === 'Marketing authorization holder' &&
                    !element.datasetElementSystem
                  ">
                  <mat-select
                    formControlName="{{ element.datasetElementId }}"
                    placeholder="{{
                      element.datasetElementDisplayName | translate
                    }}"
                    [required]="
                      sourceOfReport === 'Marketing authorization holder'
                    ">
                    <mat-option value=""></mat-option>
                    <mat-option
                      *ngFor="let item of element.selectionDataItems"
                      value="{{ item.selectionKey }}">
                      {{ item.value | translate }}
                    </mat-option>
                  </mat-select>
                  <mat-hint *ngIf="element.datasetElementHelp != ''">
                    {{ element.datasetElementHelp }}
                  </mat-hint>
                </mat-form-field>

                <mat-list
                  class="p-8 full-width"
                  *ngIf="
                    element.datasetElementType == 'RadioButton' &&
                    !element.datasetElementSystem &&
                    element.datasetElementId !== 125 &&
                    element.datasetElementId !== 131 &&
                    element.datasetElementId !== 306 &&
                    element.datasetElementId !== 300 &&
                    element.datasetElementId !== 303
                  ">
                  <h3 class="radio-button-label" mat-subheader>
                    {{ element.datasetElementDisplayName | translate }}
                  </h3>
                  <mat-radio-group
                    class="example-radio-group"
                    formControlName="{{ element.datasetElementId }}">
                    <mat-radio-button
                      class="example-radio-button"
                      *ngFor="
                        let item of element.selectionDataItems;
                        let i = index
                      "
                      value="{{ item.selectionKey }}"
                      [checked]="i === 0">
                      {{ item.value | translate }}
                    </mat-radio-button>
                  </mat-radio-group>
                </mat-list>

                <!-- Age date available -->
                <mat-list
                  class="p-8 full-width"
                  *ngIf="
                    element.datasetElementType == 'CheckBox' &&
                    !element.datasetElementSystem &&
                    element.datasetElementId === 307
                  ">
                  <mat-checkbox
                    class="example-margin"
                    formControlName="{{ element.datasetElementId }}">
                    {{ element.datasetElementDisplayName | translate }}
                  </mat-checkbox>
                </mat-list>

                <!-- Medication start date available -->
                <mat-list
                  class="p-8 full-width"
                  *ngIf="
                    element.datasetElementType == 'CheckBox' &&
                    !element.datasetElementSystem &&
                    element.datasetElementId === 306
                  ">
                  <mat-checkbox
                    class="example-margin"
                    formControlName="{{ element.datasetElementId }}">
                    {{ element.datasetElementDisplayName | translate }}
                  </mat-checkbox>
                </mat-list>

                <!-- Event start date available -->
                <mat-list
                  class="p-8 full-width"
                  *ngIf="
                    element.datasetElementType == 'CheckBox' &&
                    !element.datasetElementSystem &&
                    element.datasetElementId === 308
                  ">
                  <mat-checkbox
                    class="example-margin"
                    formControlName="{{ element.datasetElementId }}">
                    {{ element.datasetElementDisplayName | translate }}
                  </mat-checkbox>
                </mat-list>

                <!-- Was the adverse event treated? field -->
                <mat-list
                  class="p-8 full-width"
                  *ngIf="
                    element.datasetElementType == 'RadioButton' &&
                    !element.datasetElementSystem &&
                    element.datasetElementId === 125
                  ">
                  <h3 class="radio-button-label" mat-subheader>
                    {{ element.datasetElementDisplayName | translate }}
                  </h3>
                  <mat-radio-group
                    class="example-radio-group"
                    formControlName="{{ element.datasetElementId }}">
                    <mat-radio-button
                      class="example-radio-button"
                      *ngFor="
                        let item of element.selectionDataItems;
                        let i = index
                      "
                      value="{{ item.selectionKey }}"
                      [checked]="i === 0"
                      (change)="onChangeAdverseEventTreatment($event)">
                      {{ item.value | translate }}
                    </mat-radio-button>
                  </mat-radio-group>
                </mat-list>

                <!-- Outcomes attributed to the adverse event -->
                <mat-list
                  class="p-8 full-width"
                  *ngIf="
                    element.datasetElementType == 'RadioButton' &&
                    !element.datasetElementSystem &&
                    element.datasetElementId === 131
                  ">
                  <h3 class="radio-button-label" mat-subheader>
                    {{ element.datasetElementDisplayName | translate }}
                  </h3>
                  <mat-radio-group
                    class="example-radio-group"
                    formControlName="{{ element.datasetElementId }}">
                    <mat-radio-button
                      class="example-radio-button"
                      *ngFor="
                        let item of element.selectionDataItems;
                        let i = index
                      "
                      value="{{ item.selectionKey }}"
                      [checked]="i === 0"
                      (change)="onChangeOutcomeOfAdverseEvent($event)">
                      {{ item.value | translate }}
                    </mat-radio-button>
                  </mat-radio-group>
                </mat-list>

                <!-- Source of reporting -->
                <mat-list
                  class="p-8 full-width"
                  *ngIf="
                    element.datasetElementType == 'RadioButton' &&
                    !element.datasetElementSystem &&
                    element.datasetElementId === 300
                  ">
                  <h3 class="radio-button-label" mat-subheader>
                    {{ element.datasetElementDisplayName | translate }}
                  </h3>
                  <mat-radio-group
                    class="example-radio-group"
                    formControlName="{{ element.datasetElementId }}">
                    <mat-radio-button
                      class="example-radio-button"
                      *ngFor="
                        let item of element.selectionDataItems;
                        let i = index
                      "
                      value="{{ item.selectionKey }}"
                      [checked]="i === 0"
                      (change)="onChangeSourceOfReporting($event)">
                      {{ item.value | translate }}
                    </mat-radio-button>
                  </mat-radio-group>
                </mat-list>

                <!-- Report type -->
                <mat-list
                  class="p-8 full-width"
                  *ngIf="
                    element.datasetElementType == 'RadioButton' &&
                    !element.datasetElementSystem &&
                    element.datasetElementId === 303 &&
                    sourceOfReport === 'Marketing authorization holder'
                  ">
                  <h3 class="radio-button-label" mat-subheader>
                    {{ element.datasetElementDisplayName | translate }}
                  </h3>
                  <mat-radio-group
                    class="example-radio-group"
                    formControlName="{{ element.datasetElementId }}">
                    <mat-radio-button
                      class="example-radio-button"
                      *ngFor="
                        let item of element.selectionDataItems;
                        let i = index
                      "
                      value="{{ item.selectionKey }}"
                      [checked]="i === 0"
                      (change)="onChangeReportType($event)">
                      {{ item.value | translate }}
                    </mat-radio-button>
                  </mat-radio-group>
                </mat-list>

                <mat-form-field
                  class="p-8 full-width"
                  *ngIf="
                    element.datasetElementType == 'MultipleDropDownList' &&
                    element.datasetElementId !== 112 &&
                    element.datasetElementId !== 132 &&
                    element.datasetElementId !== 301 &&
                    !element.datasetElementSystem
                  ">
                  <mat-select
                    formControlName="{{ element.datasetElementId }}"
                    placeholder="{{
                      element.datasetElementDisplayName | translate
                    }}"
                    [required]="element.required"
                    multiple>
                    <mat-option
                      *ngFor="let item of element.selectionDataItems"
                      [value]="item.selectionKey">
                      {{ item.value | translate }}
                    </mat-option>
                  </mat-select>
                  <mat-hint *ngIf="element.datasetElementHelp != ''">
                    {{ element.datasetElementHelp }}
                  </mat-hint>
                </mat-form-field>

                <!-- Type of events-->
                <mat-form-field
                  class="p-8 full-width"
                  *ngIf="
                    element.datasetElementType == 'MultipleDropDownList' &&
                    element.datasetElementId === 112 &&
                    !element.datasetElementSystem
                  ">
                  <mat-select
                    formControlName="{{ element.datasetElementId }}"
                    placeholder="{{
                      element.datasetElementDisplayName | translate
                    }}"
                    [required]="element.required"
                    (selectionChange)="onChangeTypeOfEvent($event)"
                    multiple>
                    <mat-option
                      *ngFor="let item of element.selectionDataItems"
                      [value]="item.selectionKey">
                      {{ item.value | translate }}
                    </mat-option>
                  </mat-select>
                  <mat-hint *ngIf="element.datasetElementHelp != ''">
                    {{ element.datasetElementHelp }}
                  </mat-hint>
                </mat-form-field>

                <!-- Event Information-->
                <mat-form-field
                  class="p-8 full-width"
                  *ngIf="
                    element.datasetElementType == 'MultipleDropDownList' &&
                    element.datasetElementId === 301 &&
                    !element.datasetElementSystem
                  ">
                  <mat-select
                    formControlName="{{ element.datasetElementId }}"
                    placeholder="{{
                      element.datasetElementDisplayName | translate
                    }}"
                    (selectionChange)="onChangeEventInformation($event)"
                    multiple>
                    <mat-option
                      *ngFor="let item of element.selectionDataItems"
                      [value]="item.selectionKey">
                      {{ item.value | translate }}
                    </mat-option>
                  </mat-select>
                  <mat-hint *ngIf="element.datasetElementHelp != ''">
                    {{ element.datasetElementHelp }}
                  </mat-hint>
                </mat-form-field>

                <!-- Other relevant history -->
                <mat-form-field
                  class="p-8 full-width"
                  *ngIf="
                    element.datasetElementType == 'MultipleDropDownList' &&
                    element.datasetElementId === 132 &&
                    !element.datasetElementSystem
                  ">
                  <mat-select
                    formControlName="{{ element.datasetElementId }}"
                    placeholder="{{
                      element.datasetElementDisplayName | translate
                    }}"
                    [required]="element.required"
                    (selectionChange)="onChangeRelevantHistory($event)"
                    multiple>
                    <mat-option
                      *ngFor="let item of element.selectionDataItems"
                      [value]="item.selectionKey">
                      {{ item.value | translate }}
                    </mat-option>
                  </mat-select>
                  <mat-hint *ngIf="element.datasetElementHelp != ''">
                    {{ element.datasetElementHelp }}
                  </mat-hint>
                </mat-form-field>

                <mat-form-field
                  class="p-8 full-width"
                  *ngIf="
                    element.datasetElementType == 'YesNo' &&
                    !element.datasetElementSystem
                  ">
                  <mat-select
                    formControlName="{{ element.datasetElementId }}"
                    placeholder="{{
                      element.datasetElementDisplayName | translate
                    }}"
                    [required]="element.required">
                    <mat-option value=""></mat-option>
                    <mat-option value="Yes">Yes</mat-option>
                    <mat-option value="No">No</mat-option>
                  </mat-select>
                  <mat-hint *ngIf="element.datasetElementHelp != ''">
                    {{ element.datasetElementHelp }}
                  </mat-hint>
                </mat-form-field>

                <span
                  class="ml-05 mr-05 mt-05"
                  *ngIf="element.datasetElementType == 'Table'">
                  <div class="p-12 table-container">
                    <div class="pt-12 pb-12" fxLayoutAlign="end">
                      <button
                        mat-raised-button
                        color="primary"
                        (click)="
                          openPopup(
                            i,
                            0,
                            element.datasetElementId,
                            element.datasetElementSubs,
                            {},
                            true
                          )
                        ">
                        Add
                      </button>
                    </div>
                    <mat-table
                      [dataSource]="getTableDataSource(i)"
                      [@animate]="{ value: '50' }">
                      <ng-container
                        matColumnDef="{{ elementSub.datasetElementSubName }}"
                        *ngFor="let elementSub of element.datasetElementSubs">
                        <mat-header-cell *matHeaderCellDef>{{
                          elementSub.datasetElementSubName
                        }}</mat-header-cell>
                        <mat-cell *matCellDef="let record">
                          {{
                            formatOutput(record[elementSub.datasetElementSubId])
                          }}
                        </mat-cell>
                      </ng-container>

                      <ng-container matColumnDef="actions">
                        <mat-header-cell *matHeaderCellDef>{{
                          'Actions' | translate
                        }}</mat-header-cell>
                        <mat-cell
                          *matCellDef="let record; let rowIndex = index">
                          <button
                            mat-icon-button
                            color="primary"
                            matTooltip="{{ 'Update' | translate }}"
                            (click)="
                              openPopup(
                                i,
                                rowIndex,
                                element.datasetElementId,
                                element.datasetElementSubs,
                                record,
                                false
                              )
                            ">
                            <mat-icon>edit</mat-icon>
                          </button>
                          <button
                            mat-icon-button
                            color="warn"
                            matTooltip="{{ 'Delete' | translate }}"
                            (click)="
                              removeRecord(
                                i,
                                rowIndex,
                                element.datasetElementId
                              )
                            ">
                            <mat-icon>delete</mat-icon>
                          </button>
                        </mat-cell>
                      </ng-container>

                      <mat-header-row
                        *matHeaderRowDef="
                          generateColumnArray(element.datasetElementSubs);
                          sticky: true
                        "></mat-header-row>
                      <mat-row
                        *matRowDef="
                          let record;
                          columns: generateColumnArray(
                            element.datasetElementSubs
                          )
                        "></mat-row>
                    </mat-table>
                  </div>
                </span>
              </div>
            </div>

            <div fxLayout="row" class="mt-12">
              <button
                mat-raised-button
                matStepperPrevious
                type="button"
                *ngIf="i > 0">
                {{ 'Previous' | translate }}
              </button>
              <span fxFlex></span>
              <button
                mat-raised-button
                matStepperNext
                type="button"
                *ngIf="i < datasetCategories.length - 1">
                {{ 'Next' | translate }}
              </button>
            </div>
          </mat-step>
        </mat-horizontal-stepper>
      </form>

      <div class="text-center">
        <button mat-raised-button color="warn" (click)="goBack()" class="mr-12">
          {{ 'Cancel' | translate }}
        </button>
        <button
          mat-raised-button
          color="accent"
          (click)="saveForm()"
          [disabled]="viewModelForm.invalid">
          <mat-icon class="mr-4">save</mat-icon
          >{{ 'Submit Report' | translate }}
        </button>
      </div>
    </div>
  </div>
</div>
